Tool calling with structured outputs requires generateText/streamText + output option; adjust stopWhen step count to include structured output generation step.